<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this file,
   - You can obtain one at http://mozilla.org/MPL/2.0/. -->
<!DOCTYPE html>
<html><head>
  <meta http-equiv="Content-Security-Policy" content="default-src chrome:; img-src data: *; media-src *; object-src 'none'">
  <meta content="text/html; charset=UTF-8" http-equiv="content-type">
  <meta name="viewport" content="width=device-width; user-scalable=0">
  <link rel="stylesheet" href="chrome://global/skin/aboutReader.css" type="text/css">
  <script src="chrome://global/content/reader/aboutReader.js"></script>
<link rel="stylesheet" href="chrome://global/skin/narrate.css"><title>QEMU full virtualization – CPU emulations (enable/disable CPU flags/instruction sets)</title></head>

<body class="light sans-serif loaded">
  <div class="container content-width3" style="--font-size:20px;">
    <div class="header reader-header reader-show-element">
      <a class="domain reader-domain" href="https://ahelpme.com/howto/qemu-full-virtualization-cpu-emulations-enable-disable-cpu-flags-instruction-sets/">ahelpme.com</a>
      <div class="domain-border"></div>
      <h1 class="reader-title">QEMU full virtualization – CPU emulations (enable/disable CPU flags/instruction sets)</h1>
      <div class="credits reader-credits"></div>
      <div class="meta-data">
        <div class="reader-estimated-time">10-13 minutes</div>
      </div>
    </div>

    <hr>

    <div class="content">
      <div class="moz-reader-content line-height4 reader-show-element"><div id="readability-page-1" class="page"><article id="post-651">
	

	
	
	<div>
		<p>After the two QEMU full virtualization howtos</p>
<ul>
<li><a href="https://ahelpme.com/linux/howto-do-qemu-full-virtualization-with-macvtap-networking/" rel="noopener" target="_blank">Howto do QEMU full virtualization with MacVTap networking</a></li>
<li><a href="https://ahelpme.com/linux/howto-do-qemu-full-virtualization-with-bridged-networking/" rel="noopener" target="_blank">Howto do QEMU full virtualization with bridged networking</a></li>
</ul>
<p>You can use qemu have a nearly native full virtualization. Here are 
some important tips for the guest CPU to consider when using qemu 
directly (without any virtualization manager like virt-manager, libvirt 
and so on).</p>
<h3>TIP 1)Choose your host CPU emulation</h3>
<p>You can see what options are available for host emulation with:</p>
<div><div id="highlighter_410212"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p></td><td><div><p><code>srv@</code><code>local</code> <code>~$ qemu-system-x86_64 -cpu help</code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; qemu64&nbsp; QEMU Virtual CPU version 2.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phenom&nbsp; AMD Phenom(tm) 9550 Quad-Core Processor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; core2duo&nbsp; Intel(R) Core(TM)2 Duo CPU&nbsp;&nbsp;&nbsp;&nbsp; T7700&nbsp; @ 2.40GHz </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kvm64&nbsp; Common KVM processor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; qemu32&nbsp; QEMU Virtual CPU version 2.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kvm32&nbsp; Common 32-bit KVM processor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; coreduo&nbsp; Genuine Intel(R) CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T2600&nbsp; @ 2.16GHz </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 486&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pentium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pentium2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pentium3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; athlon&nbsp; QEMU Virtual CPU version 2.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n270&nbsp; Intel(R) Atom(TM) CPU N270&nbsp;&nbsp; @ 1.60GHz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Conroe&nbsp; Intel Celeron_4x0 (Conroe</code><code>/Merom</code> <code>Class Core 2)&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Penryn&nbsp; Intel Core 2 Duo P9xxx (Penryn Class Core 2)&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Nehalem&nbsp; Intel Core i7 9xx (Nehalem Class Core i7)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Westmere&nbsp; Westmere E56xx</code><code>/L56xx/X56xx</code> <code>(Nehalem-C)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SandyBridge&nbsp; Intel Xeon E312xx (Sandy Bridge)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Haswell&nbsp; Intel Core Processor (Haswell)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Opteron_G1&nbsp; AMD Opteron 240 (Gen 1 Class Opteron)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Opteron_G2&nbsp; AMD Opteron 22xx (Gen 2 Class Opteron)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Opteron_G3&nbsp; AMD Opteron 23xx (Gen 3 Class Opteron)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Opteron_G4&nbsp; AMD Opteron 62xx class CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Opteron_G5&nbsp; AMD Opteron 63xx class CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>x86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; host&nbsp; KVM processor with all supported host features (only available </code><code>in</code> <code>KVM mode)</code></p><p><code>Recognized CPUID flags:</code></p><p><code>&nbsp;&nbsp;</code><code>pbe ia64 tm ht ss sse2 sse fxsr mmx acpi ds clflush pn pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de vme fpu</code></p><p><code>&nbsp;&nbsp;</code><code>hypervisor rdrand f16c avx osxsave xsave aes tsc-deadline popcnt movbe x2apic sse4.2|sse4_2 sse4.1|sse4_1 dca pcid pdcm xtpr cx16 fma cid ssse3 tm2 est smx vmx ds_cpl monitor dtes64 pclmulqdq|pclmuldq pni|sse3</code></p><p><code>&nbsp;&nbsp;</code><code>smap adx rdseed rtm invpcid erms bmi2 smep avx2 hle bmi1 fsgsbase</code></p><p><code>&nbsp;&nbsp;</code><code>3dnow 3dnowext lm|i64 rdtscp pdpe1gb fxsr_opt|ffxsr mmxext nx|xd syscall</code></p><p><code>&nbsp;&nbsp;</code><code>perfctr_nb perfctr_core topoext tbm nodeid_msr tce fma4 lwp wdt skinit xop ibs osvw 3dnowprefetch misalignsse sse4a abm cr8legacy extapic svm cmp_legacy lahf_lm</code></p><p><code>&nbsp;&nbsp;</code><code>pmm-en pmm phe-en phe ace2-en ace2 xcrypt-en xcrypt xstore-en xstore</code></p><p><code>&nbsp;&nbsp;</code><code>kvm_pv_unhalt kvm_pv_eoi kvm_steal_time kvm_asyncpf kvmclock kvm_mmu kvm_nopiodelay kvmclock</code></p><p><code>&nbsp;&nbsp;</code><code>pfthreshold pause_filter decodeassists flushbyasid vmcb_clean tsc_scale nrip_save svm_lock lbrv npt</code></p></div></td></tr></tbody></table></div></div>
<p>The host server will expose different instruction set to the guest 
server (the emulated CPU), so when you choose your host to emulate for 
example “qemu64” with:</p>
<div><div id="highlighter_9"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>qemu-system-x86_64 -</code><code>enable</code><code>-kvm&nbsp; \</code></p><p><code>-cpu qemu64,+ssse3,+sse4.1,+sse4.2,+x2apic -smp 2,maxcpus=8 \</code></p><p><code>-daemonize -vnc 192.168.0.10:1 \</code></p><p><code>-drive </code><code>file</code><code>=</code><code>/mnt/storage/qemu/roofs/srv_virt</code><code>.qcow2,index=0,cache=none,aio=threads,</code><code>if</code><code>=virtio \</code></p><p><code>-cdrom </code><code>/mnt/storage/images/install-amd64-minimal-20140327</code><code>.iso -boot d \</code></p><p><code>-net nic,model=virtio,macaddr=$(&lt; </code><code>/sys/class/net/macvtap0/address</code><code>) \</code></p><p><code>-net tap,fd=3 3&lt;&gt;</code><code>/dev/tap</code><code>$(&lt; </code><code>/sys/class/net/macvtap0/ifindex</code><code>) \</code></p><p><code>-balloon virtio -m 8192 \</code></p><p><code>-monitor telnet:127.0.0.1:5801,server,nowait -writeconfig </code><code>/opt/qemu/config/srv_virt</code><code>.qcow2.conf</code></p></div></td></tr></tbody></table></div></div>
<p>The guest server (the virtual machine) will have the following CPU and instruction set:</p>
<div><div id="highlighter_375659"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p></td><td><div><p><code>vendor_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : GenuineIntel</code></p><p><code>cpu family&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 6</code></p><p><code>model&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 6</code></p><p><code>model name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : QEMU Virtual CPU version 2.0.0</code></p><p><code>stepping&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 3</code></p><p><code>microcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0x1</code></p><p><code>cpu MHz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 2133.408</code></p><p><code>cache size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4096 KB</code></p><p><code>fpu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>fpu_exception&nbsp;&nbsp; : </code><code>yes</code></p><p><code>cpuid level&nbsp;&nbsp;&nbsp;&nbsp; : 4</code></p><p><code>wp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pse36 clflush mmx fxsr sse sse2 syscall nx lm rep_good nopl pni ssse3 cx16 sse4_1 x2apic popcnt hypervisor lahf_lm</code></p><p><code>bogomips&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4266.81</code></p><p><code>clflush size&nbsp;&nbsp;&nbsp; : 64</code></p><p><code>cache_alignment : 64</code></p><p><code>address sizes&nbsp;&nbsp; : 40 bits physical, 48 bits virtual</code></p><p><code>power management:</code></p><p><code>processor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 1</code></p><p><code>vendor_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : GenuineIntel</code></p><p><code>cpu family&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 6</code></p><p><code>model&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 6</code></p><p><code>model name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : QEMU Virtual CPU version 2.0.0</code></p><p><code>stepping&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 3</code></p><p><code>microcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0x1</code></p><p><code>cpu MHz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 2133.408</code></p><p><code>cache size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4096 KB</code></p><p><code>fpu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>fpu_exception&nbsp;&nbsp; : </code><code>yes</code></p><p><code>cpuid level&nbsp;&nbsp;&nbsp;&nbsp; : 4</code></p><p><code>wp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pse36 clflush mmx fxsr sse sse2 syscall nx lm rep_good nopl pni ssse3 cx16 sse4_1 x2apic popcnt hypervisor lahf_lm</code></p><p><code>bogomips&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4266.81</code></p><p><code>clflush size&nbsp;&nbsp;&nbsp; : 64</code></p><p><code>cache_alignment : 64</code></p><p><code>address sizes&nbsp;&nbsp; : 40 bits physical, 48 bits virtual</code></p><p><code>power management:</code></p></div></td></tr></tbody></table></div></div>
<p>A base set of instructions (flags) with the explicitly included by our command with </p>
<blockquote><p>+ssse3,+sse4.1,+sse4.2,+x2apic</p></blockquote>
<p>. The format:</p>
<blockquote><p>-cpu qemu64,+ssse3,+sse4.1,+sse4.2,+x2apic</p></blockquote>
<p>IF you choose the last option: </p>
<blockquote><p>-cpu host</p></blockquote>
<p> the host server will try to emulate and expose to the virtual machine its processor and all flags:</p>
<div><div id="highlighter_127286"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>qemu-system-x86_64 -</code><code>enable</code><code>-kvm&nbsp; \</code></p><p><code>-cpu host -smp 2,maxcpus=8 \</code></p><p><code>-daemonize -vnc 192.168.0.10:1 \</code></p><p><code>-drive </code><code>file</code><code>=</code><code>/mnt/storage/qemu/roofs/srv_virt</code><code>.qcow2,index=0,cache=none,aio=threads,</code><code>if</code><code>=virtio \</code></p><p><code>-cdrom </code><code>/mnt/storage/images/install-amd64-minimal-20140327</code><code>.iso -boot d \</code></p><p><code>-net nic,model=virtio,macaddr=$(&lt; </code><code>/sys/class/net/macvtap0/address</code><code>) \</code></p><p><code>-net tap,fd=3 3&lt;&gt;</code><code>/dev/tap</code><code>$(&lt; </code><code>/sys/class/net/macvtap0/ifindex</code><code>) \</code></p><p><code>-balloon virtio -m 8192 \</code></p><p><code>-monitor telnet:127.0.0.1:5801,server,nowait -writeconfig </code><code>/opt/qemu/config/srv_virt</code><code>.qcow2.conf</code></p></div></td></tr></tbody></table></div></div>
<p><strong>The virtual machine:</strong></p>
<div><div id="highlighter_801855"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p></td><td><div><p><code>[root@vm0 ~]</code></p><p><code>processor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0</code></p><p><code>vendor_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : GenuineIntel</code></p><p><code>cpu family&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 6</code></p><p><code>model&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 44</code></p><p><code>model name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Intel(R) Xeon(R) CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E5606&nbsp; @ 2.13GHz</code></p><p><code>stepping&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 2</code></p><p><code>microcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0x1</code></p><p><code>cpu MHz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 2133.408</code></p><p><code>cache size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 8192 KB</code></p><p><code>fpu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>fpu_exception&nbsp;&nbsp; : </code><code>yes</code></p><p><code>cpuid level&nbsp;&nbsp;&nbsp;&nbsp; : 11</code></p><p><code>wp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes hypervisor lahf_lm tsc_adjust</code></p><p><code>bogomips&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4266.81</code></p><p><code>clflush size&nbsp;&nbsp;&nbsp; : 64</code></p><p><code>cache_alignment : 64</code></p><p><code>address sizes&nbsp;&nbsp; : 40 bits physical, 48 bits virtual</code></p><p><code>power management:</code></p></div></td></tr></tbody></table></div></div>
<p><strong>The host server:</strong></p>
<div><div id="highlighter_368487"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p></td><td><div><p><code>[root@srv0 ~]</code></p><p><code>processor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0</code></p><p><code>vendor_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : GenuineIntel</code></p><p><code>cpu family&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 6</code></p><p><code>model&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 44</code></p><p><code>model name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Intel(R) Xeon(R) CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; E5606&nbsp; @ 2.13GHz</code></p><p><code>stepping&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 2</code></p><p><code>microcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0x14</code></p><p><code>cpu MHz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 1200.000</code></p><p><code>cache size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 8192 KB</code></p><p><code>physical </code><code>id</code>&nbsp;&nbsp;&nbsp;&nbsp; <code>: 0</code></p><p><code>siblings&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4</code></p><p><code>core </code><code>id</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code>: 0</code></p><p><code>cpu cores&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4</code></p><p><code>apicid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0</code></p><p><code>initial apicid&nbsp; : 0</code></p><p><code>fpu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>fpu_exception&nbsp;&nbsp; : </code><code>yes</code></p><p><code>cpuid level&nbsp;&nbsp;&nbsp;&nbsp; : 11</code></p><p><code>wp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </code><code>yes</code></p><p><code>flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt aes lahf_lm tpr_shadow vnmi flexpriority ept vpid dtherm arat</code></p><p><code>bogomips&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 4266.41</code></p><p><code>clflush size&nbsp;&nbsp;&nbsp; : 64</code></p><p><code>cache_alignment : 64</code></p><p><code>address sizes&nbsp;&nbsp; : 40 bits physical, 48 bits virtual</code></p><p><code>power management:</code></p></div></td></tr></tbody></table></div></div>
<h3>TIP 2) Disable certain CPU flags (instruction sets)</h3>
<p>As you can see with the above CPU options you can hide your exact 
type of processor and you could disable specific CPU flags (instruction 
sets) to the user’s virtual machine. The purpose is up to the user and 
one reason for example could be not offer “avx” (or “avx2”) to 
discourage crypto mining with the virtual machine. Or limit the 
SSE2/3/4/4.2/SSSE3 and other “multimedia” instruction sets to discourage
 video encoding and so on. Probably you would like to be used  It’s up 
to you what to offer to the virtual machine user.<br>
Here is the command to emulate the host CPU with all supported flags but disable “sse4.1” and “sse4.2”:<br>
The syntax: </p>
<blockquote><p>-cpu host,-sse4.1,-sse4.2</p></blockquote>
<p>And the qemu command is:</p>
<div><div id="highlighter_213362"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p></td><td><div><p><code>qemu-system-x86_64 -</code><code>enable</code><code>-kvm \</code></p><p><code>-cpu host,-sse4.1,-sse4.2 \</code></p><p><code>-smp 2,maxcpus=8 \</code></p><p><code>-daemonize -vnc 192.168.0.10:1 \</code></p><p><code>-drive </code><code>file</code><code>=</code><code>/mnt/storage/qemu/roofs/srv_virt</code><code>.qcow2,index=0,cache=none,aio=threads,</code><code>if</code><code>=virtio \</code></p><p><code>-cdrom </code><code>/mnt/storage/images/install-amd64-minimal-20140327</code><code>.iso -boot d \</code></p><p><code>-net nic,model=virtio,macaddr=$(&lt; </code><code>/sys/class/net/macvtap0/address</code><code>) \</code></p><p><code>-net tap,fd=3 3&lt;&gt;</code><code>/dev/tap</code><code>$(&lt; </code><code>/sys/class/net/macvtap0/ifindex</code><code>) \</code></p><p><code>-balloon virtio -m 8192 \</code></p><p><code>-monitor telnet:127.0.0.1:5801,server,nowait -writeconfig </code><code>/opt/qemu/config/srv_virt</code><code>.qcow2.conf</code></p></div></td></tr></tbody></table></div></div>
<p>So the virtual machine lacks the disabled flags:</p>
<blockquote><p>flags           : fpu vme de pse tsc msr pae mce cx8 apic
 sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx
 pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl pni pclmulqdq
 ssse3 cx16 pcid x2apic popcnt tsc_deadline_timer aes hypervisor lahf_lm
 tsc_adjust</p></blockquote>
<h3>TIP 3) Number of virtual processors in the virtual machine</h3>
<p>The syntax</p>
<blockquote><p>-smp 2,maxcpus=8</p></blockquote>
<p>of the qemu command:</p>
<div><div id="highlighter_765044"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>qemu-system-x86_64 -</code><code>enable</code><code>-kvm&nbsp; -cpu host \</code></p><p><code>-smp 2,maxcpus=8 \</code></p><p><code>-daemonize -vnc 192.168.0.10:1 \</code></p><p><code>-drive </code><code>file</code><code>=</code><code>/mnt/storage/qemu/roofs/srv_virt</code><code>.qcow2,index=0,cache=none,aio=threads,</code><code>if</code><code>=virtio \</code></p><p><code>-cdrom </code><code>/mnt/storage/images/install-amd64-minimal-20140327</code><code>.iso -boot d \</code></p><p><code>-net nic,model=virtio,macaddr=$(&lt; </code><code>/sys/class/net/macvtap0/address</code><code>) \</code></p><p><code>-net tap,fd=3 3&lt;&gt;</code><code>/dev/tap</code><code>$(&lt; </code><code>/sys/class/net/macvtap0/ifindex</code><code>) \</code></p><p><code>-balloon virtio -m 8192 \</code></p><p><code>-monitor telnet:127.0.0.1:5801,server,nowait -writeconfig </code><code>/opt/qemu/config/srv_virt</code><code>.qcow2.conf</code></p></div></td></tr></tbody></table></div></div>
<p>will start up the virtual machine with 2 processors and you can hot 
add a cpu up to 8 total in any time you want with the management console
 listening on 127.0.0.1:5801.</p>
	</div>

	
</article></div></div>
    </div>

    <div>
      <div class="reader-message">Loading…</div>
    </div>
  </div>

  <ul class="toolbar reader-toolbar">
    <li><button class="button close-button" title="Close Reader View"></button></li>
    <ul class="dropdown style-dropdown">
      <li><button class="dropdown-toggle button style-button" title="Type controls"></button></li>
      <li class="dropdown-popup">
        <div class="font-type-buttons"><button class="sans-serif-button selected"><div class="name">Aa</div><div class="description">Sans-serif</div></button><button class="serif-button"><div class="name">Aa</div><div class="description">Serif</div></button></div>
        <hr>
        <div class="font-size-buttons">
          <button class="minus-button" title="Decrease Font Size">
          </button><button class="font-size-sample">Aa</button><button class="plus-button" title="Increase Font Size">
        </button></div>
        <hr>
        <div class="content-width-buttons">
          <button class="content-width-minus-button" title="Decrease Content Width">
          </button><button class="content-width-plus-button" title="Increase Content Width">
        </button></div>
        <hr>
        <div class="line-height-buttons">
          <button class="line-height-minus-button" title="Decrease Line Height">
          </button><button class="line-height-plus-button" title="Increase Line Height">
        </button></div>
        <hr>
        <div class="color-scheme-buttons"><button class="light-button selected" title="Color Scheme Light"><div class="name">Light</div></button><button class="dark-button" title="Color Scheme Dark"><div class="name">Dark</div></button><button class="sepia-button" title="Color Scheme Sepia"><div class="name">Sepia</div></button></div>
        <div class="dropdown-arrow">
      </div></li>
    </ul>
  <ul class="dropdown narrate-dropdown"><li><button class="dropdown-toggle button narrate-toggle" title="Narrate" hidden=""></button></li><li class="dropdown-popup"><div class="narrate-row narrate-control"><button class="narrate-skip-previous" disabled="disabled" title="Back"></button><button class="narrate-start-stop" title="Start"></button><button class="narrate-skip-next" disabled="disabled" title="Forward"></button></div><div class="narrate-row narrate-rate"><input class="narrate-rate-input" value="0" step="5" max="100" min="-100" type="range" title="Speed"></div><div class="narrate-row narrate-voices"><div class="voiceselect voice-select"><button class="select-toggle" aria-controls="voice-options">
      <span class="label">Voice:</span> <span class="current-voice"></span>
    </button>
    <div class="options" id="voice-options" role="listbox"></div></div></div><div class="dropdown-arrow"></div></li></ul><button data-buttonid="pocket-button" class="button pocket-button" style="background-image: url(&quot;chrome://pocket/content/panels/img/pocket-outline.svg&quot;); background-size: 20px 20px;" title="Save to Pocket"></button></ul>




</body></html>